<!DOCTYPE html>
{% load static %}
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- cdn bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'styles/style.css' %}">



        <!-- <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}" > -->
        <link rel="stylesheet" href="{% static 'evk-calendar/evk_calendar_jk.css' %}"  />
        <link rel="stylesheet" href="{% static 'styles/translation.css' %}">

        <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css"> -->
        <script src="https://kit.fontawesome.com/bb0c45263e.js" crossorigin="anonymous"></script>
        {% block head %}
        {% endblock %}
        <!-- <link rel="stylesheet" href="{% static 'styles/signin.css' %}"> -->    
    </head>
    <body>
        <!-- {% include 'base/navbar.html' %} -->
        {% block content %}
        {% endblock %}
       
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="{% static 'jquery-3.7.1.min.js' %}"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="{% static 'bootstrap-5.3.3/js/bootstrap.min.js' %}"></script> -->
        <script  src="{% static 'evk-calendar/evk_calendar_jk.js' %}" ></script>
        <script src="{% static 'js/script.js' %}"></script>
        <script type="text/javascript">

    $(document).on("click",".lang_dd",function() {
        var lang = $(this).data("language");
        var lang_name = $(this).text();
        console.log(lang);
        $.ajax({
            url: "/farmer/switch_story/" + lang,       // URL endpoint
            type: "GET",    // Data to send to the server
            success: function (response) {
                console.log(response.story); // "Hello, {name}!"
                console.log(response.languages);
                $("#story_div").html('<p id="story-text">' + response.story + '</p>');
                $("#edit_story_modal").val(response.story);
                $('#edit_story_lang').val(lang)
                // $("#edit_story_form").attr('action',"");
                // $("#lang_ul").text(response.languages);
                $("#lang_a").text(lang_name);
                new_li = '';
                for (var i = 0; i < response.languages.length; i++) {
                    new_li += '<li class="lang_dd" data-language="' + response.languages[i][0] + '"><a class="dropdown-item" href="#">' + response.languages[i][1] + '</a></li>\n';
                }
                $("#lang_ul").html(new_li);
                // $('#result').text(response.message); // Update a div with the response
            },
            error: function (xhr, status, error) {
                $("#lang_a").text(lang_name);
                $('#add_story_lang').val(lang)
                $('#story_div').html('<button id="add_story" class="ms-2 btn btn-sm"  style="background-color: green; color: white; " data-bs-toggle="modal" data-bs-target="#addstoryModal">Add new story</button>');
                console.error("Error:", error);
            },
            });
        
    })

    $(document).on("submit","#edit_story_form",function(event) {
        event.preventDefault();

        var formData = $(this).serialize();
        console.log(formData);
        $.ajax({
            url: "/farmer/update_story/",       // URL endpoint
            type: "POST",    // Data to send to the server
            data: formData,
            success: function (response) {
                // $("#story-text").text(response.story);
                $('#story_div').html('<p id="story-text">' + response.story + '</p>');
                $("#storyModal").modal('hide');
                
                // console.log(response.story);
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            },
    });
    });

    $(document).on("submit","#add_story_form",function(event) {
        event.preventDefault();

        var formData = $(this).serialize();
        console.log(formData);
        $.ajax({
            url: "/farmer/add_story/",       // URL endpoint
            type: "POST",    // Data to send to the server
            data: formData,
            success: function (response) {
                // console.log(response.story);
                $('#story_div').html('<p id="story-text">' + response.story + '</p>');
                $("#addstoryModal").modal('hide');
                
                // console.log(response.story);
            },
            error: function (xhr, status, error) {
                console.error("Error:", error);
            },
    });
    });
    
    pageLanguage = 'en';
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'en,es,fr,de,it',}, 'google_translate_element');
    }

    $(document).ready(function () {
        setTimeout(function () {
            let selectElement = $(".goog-te-combo");

            // Restore language selection from localStorage
            let storedLang = localStorage.getItem("selectedLanguage");
            if (storedLang) {
                selectElement.val(storedLang).trigger("change");
            }

            // Listen for language selection change
            selectElement.on("change", function () {
                let selectedLang = $(this).val();
                localStorage.setItem("selectedLanguage", selectedLang);
            });
        }, 2000); // Delay to allow Google Translate to load
    });

    $(document).on("click",".lang_dd2",function() {
        var lang = $(this).data("language");
        var user = $(this).data("user");
        var lang_name = $(this).text();
        console.log(lang);
        $.ajax({
            url: "/roaster/switch_story/" + lang +"/" + user,       // URL endpoint
            type: "GET",    // Data to send to the server
            success: function (response) {
                console.log(response.story); // "Hello, {name}!"
                console.log(response.languages);
                $("#story_div").html('<p id="story-text">' + response.story + '</p>');
                // $("#edit_story_modal").val(response.story);
                // $('#edit_story_lang').val(lang)
                // $("#edit_story_form").attr('action',"");
                // $("#lang_ul").text(response.languages);
                $("#lang_a").text(lang_name);
                new_li = '';
                for (var i = 0; i < response.languages.length; i++) {
                    new_li += '<li class="lang_dd2" data-user="' + user + '" data-language="' + response.languages[i][0] + '"><a class="dropdown-item" href="#">' + response.languages[i][1] + '</a></li>\n';
                }
                $("#lang_ul").html(new_li);
                // $('#result').text(response.message); // Update a div with the response
            },
            error: function (xhr, status, error) {
                $("#lang_a").text(lang_name);
                $('#add_story_lang').val(lang)
                $('#story_div').html('Could not fetch story in this language');
                console.error("Error:", error);
            },
            });
        
    })

    

    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
        </body>
</html>

