<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Farmer Dashboard</title>
</head>
<body>
    <h1>Farmer Dashboard</h1>
    <p>Welcome, {{ request.user.username }}!</p>
    <a href="{% url 'upload_photo' %}">Add photo</a>
    <a href="{% url 'signout' %}">Sign out</a>

    {% if farmer_profile %}
        <h2>Your Profile</h2>
        <p>Farm Name: {{ farmer_profile.farm_name }}</p>
        <p>Location: {{ farmer_profile.location }}</p>
        <p>Bio: {{ farmer_profile.bio }}</p>
        <p>Size: {{ farmer_profile.size }}</p>
        <p>Affiliation: {{ farmer_profile.affiliation }}</p>
    {% else %}
        <p>No profile information available.</p>
    {% endif %}

    {% if farmer_profile %}
        <h2>Edit Your Profile</h2>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Save Changes</button>
        </form>
    {% else %}
        <p>No profile information available.</p>
    {% endif %}

    <h2>Your Photos</h2>
    <ul>
        {% for photo in farmer_photos %}
            <li><img src="{{ photo.photo.url }}" alt="Photo {{ photo.id }}" width="200" /></li>
        {% endfor %}
    </ul>

    {% if not can_request_meetings %}
        <div class="error">You can only have up to 5 pending or accepted meeting requests at a time.</div>
    {% endif %}

    <h2>Available Roasters</h2>
    <ul>
        {% for roaster in roasters %}
            <li>
                {{ roaster.user.username }}
                {% if can_request_meetings %}
                    <a href="{% url 'request_meeting' roaster.user.id %}">Request Meeting</a>
                {% else %}
                    <span>Cannot request more meetings</span>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2>Meeting Requests to You</h2>
    <ul>
        {% for meeting_request in meeting_requests_as_requestee %}
            <li>
                Meeting request from {{ meeting_request.requester.username }} on {{ meeting_request.proposed_date }}
                <p>Message: {{ meeting_request.message }}</p>
                {% if meeting_request.status == 'pending' %}
                    <a href="{% url 'manage_meeting_request' meeting_request.id 'accept' %}">Accept</a>
                    <a href="{% url 'manage_meeting_request' meeting_request.id 'reject' %}">Reject</a>
                {% else %}
                    Status: {{ meeting_request.status }}
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2>Your Meeting Requests</h2>
    <ul>
        {% for meeting_request in meeting_requests_as_requester %}
            <li>
                Meeting request to {{ meeting_request.requestee.username }} on {{ meeting_request.proposed_date }} - Status: {{ meeting_request.status }}
            </li>
        {% endfor %}
    </ul>

    <h2>Pending Meetings</h2>
    <ul>
        {% for meeting in pending_meetings %}
            <li>
                Meeting with
                {% if meeting.requester == request.user %}
                    {{ meeting.requestee.username }}
                {% else %}
                    {{ meeting.requester.username }}
                {% endif %}
                on {{ meeting.proposed_date }} - Status: {{ meeting.status }}
            </li>
        {% endfor %}
    </ul>
</body>
</html>
